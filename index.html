<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Lucky Pit ‚Äî Demo web (inspirado en CloverPit)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#ffd166;--muted:#9aa4b2;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071022 0%, #081426 60%);color:#e6eef6}
    .app{max-width:980px;margin:18px auto;padding:16px}
    header{display:flex;gap:12px;align-items:center}
    h1{font-size:20px;margin:0}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:16px;margin-top:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .machine{display:flex;flex-direction:column;gap:12px;align-items:center;padding:12px}
    .reels{display:grid;grid-template-columns:repeat(3,110px);gap:8px}
    .reel{width:110px;height:110px;background:var(--glass);display:flex;flex-direction:column;border-radius:8px;padding:6px;align-items:center;justify-content:center}
    .cell{width:86px;height:26px;border-radius:6px;background:rgba(0,0,0,0.25);display:flex;align-items:center;justify-content:center;font-weight:600}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:10px;font-weight:700;color:#081226}
    .muted{color:var(--muted);font-size:13px}
    .sidebar{display:flex;flex-direction:column;gap:10px}
    .stat-row{display:flex;justify-content:space-between;gap:8px;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
    .store{display:flex;flex-direction:column;gap:8px;max-height:380px;overflow:auto;padding:6px}
    .amulet{display:flex;justify-content:space-between;gap:8px;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px;align-items:center}
    .equipped{border:2px solid rgba(255,209,102,0.18)}
    .footer{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    .big{font-size:18px;font-weight:800}
    @media (max-width:900px){.grid{grid-template-columns:1fr}.sidebar{order:2}}
    .hint{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Lucky Pit ‚Äî Demo web (inspirado en CloverPit)</h1>
      <div class="muted">Versi√≥n simplificada para navegar en iPad. Guarda autom√°ticamente.</div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="machine">
          <div class="big">M√°quina de Tragamonedas</div>
          <div id="reels" class="reels">
            <!-- 3 reels x 3 rows rendered by JS -->
          </div>

          <div class="controls">
            <button id="spinBtn">Girar (1 spin)</button>
            <button id="multiSpinBtn">Girar x3</button>
            <button id="bankBtn">Depositar en ATM</button>
            <button id="rerollStoreBtn">Re-roll Tienda (-50 coins)</button>
            <div class="muted" id="spinsLeft">Tiradas restantes: 0</div>
          </div>

          <div class="hint">Objetivo (deadline): Pagar la deuda antes de agotar tiradas. Usa amuletos para mejorar probabilidades.</div>
          <div class="footer">
            <div class="stat-row" style="min-width:200px"> <div>Dinero</div><div id="coins">0</div></div>
            <div class="stat-row" style="min-width:200px"> <div>Tickets</div><div id="tickets">0</div></div>
            <div class="stat-row" style="min-width:200px"> <div>ATM</div><div id="atm">0</div></div>
          </div>
        </div>
      </section>

      <aside class="sidebar card">
        <div class="big">Estado</div>
        <div class="muted">Deadline objetivo</div>
        <div class="stat-row"><div>Meta</div><div id="goal">100</div></div>
        <div class="stat-row"><div>Deadline n¬∫</div><div id="round">1</div></div>
        <div class="stat-row"><div>Suerte</div><div id="luck">0/10</div></div>

        <hr style="border:none;height:8px;opacity:0.02" />
        <div class="big">Tienda de Amuletos</div>
        <div class="muted">Compra con tickets. Equipa hasta 4 amuletos.</div>
        <div id="store" class="store"></div>

        <div class="big">Amuletos equipados</div>
        <div id="equipped" style="display:flex;gap:8px;flex-wrap:wrap"></div>

        <hr style="border:none;height:8px;opacity:0.02" />
        <div class="muted">Controles de partida</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="newRunBtn">Nueva Partida</button>
          <button id="saveBtn">Guardar</button>
          <button id="loadBtn">Cargar</button>
        </div>

        <div style="margin-top:10px" class="hint">Consejo r√°pido: comienza comprando 1-2 amuletos que aumenten s√≠mbolos y guarda tickets para amuletos fuertes.</div>
      </aside>
    </div>

    <footer style="text-align:center;margin-top:12px;color:var(--muted)">Hecho como demo: inspirado en las mec√°nicas de CloverPit sin copiar activos ni contenido protegido.</footer>
  </div>

<script>
// ----- DATA & HELPERS -----
const SYMBOLS = [
  {id:'üçã',name:'Lemon',weight:13,value:3},
  {id:'üçí',name:'Cherry',weight:13,value:4},
  {id:'üçÄ',name:'Clover',weight:10,value:6},
  {id:'üîî',name:'Bell',weight:10,value:8},
  {id:'üíé',name:'Diamond',weight:8,value:14},
  {id:'7Ô∏è‚É£',name:'Seven',weight:6,value:25}
];

function weightedPick(weights){
  const s = weights.reduce((a,b)=>a+b,0);
  let r = Math.random()*s;
  for(let i=0;i<weights.length;i++){
    r -= weights[i]; if(r<0) return i;
  }
  return weights.length-1;
}

function clamp(v,a,b){return Math.max(a,Math.min(b,v))}

// ----- GAME STATE -----
let state = {
  coins:120,
  tickets:2,
  atm:0,
  round:1,
  goal:100,
  spinsLeft:10,
  luck:0, // 0..10
  store:[],
  equipped:[],
  symbols: JSON.parse(JSON.stringify(SYMBOLS))
};

// ----- AMULETS (small curated set) -----
const AMULETS_BASE = [
  {id:'more_cherries',name:'M√°s Cerezas',cost:3,desc:'Aumenta peso de Cherry +8',apply:()=>({mod:{Cherry:8}})},
  {id:'extra_spin',name:'Tiradas Extra',cost:4,desc:'+2 spins cada deadline',apply:()=>({spins:+2})},
  {id:'interest_plus',name:'Inter√©s +',cost:5,desc:'ATM gana +4% por deadline',apply:()=>({interest:+0.04})},
  {id:'ticket_seed',name:'Cloverpot',cost:3,desc:'Ganas +1 ticket al final si te quedan >=3',apply:()=>({ticketSeed:1})},
  {id:'lucky_charm',name:'Lucky Charm',cost:7,desc:'Aumenta suerte +3 al activarse',apply:()=>({luck:+3})},
  {id:'double_value',name:'Valor Doble',cost:6,desc:'Si consigues 3 patrones, duplica su valor esta ronda',apply:()=>({doubleOnCombo:true})}
];

// ----- UI SETUP -----
const reelsEl = document.getElementById('reels');
const coinsEl = document.getElementById('coins');
const ticketsEl = document.getElementById('tickets');
const atmEl = document.getElementById('atm');
const goalEl = document.getElementById('goal');
const roundEl = document.getElementById('round');
const spinsLeftEl = document.getElementById('spinsLeft');
const luckEl = document.getElementById('luck');
const storeEl = document.getElementById('store');
const equippedEl = document.getElementById('equipped');

function renderReelsGrid(grid){
  reelsEl.innerHTML='';
  for(let c=0;c<3;c++){
    const col = document.createElement('div');col.className='reel';
    for(let r=0;r<3;r++){
      const cell = document.createElement('div');cell.className='cell';cell.textContent=grid[c][r];col.appendChild(cell);
    }
    reelsEl.appendChild(col);
  }
}

function renderUI(){
  coinsEl.textContent = state.coins;
  ticketsEl.textContent = state.tickets;
  atmEl.textContent = state.atm;
  goalEl.textContent = state.goal;
  roundEl.textContent = state.round;
  spinsLeftEl.textContent = 'Tiradas restantes: '+state.spinsLeft;
  luckEl.textContent = state.luck + '/10';

  // store
  storeEl.innerHTML='';
  state.store.forEach((a,i)=>{
    const row = document.createElement('div');row.className='amulet';
    const left = document.createElement('div');left.innerHTML=`<strong>${a.name}</strong><div class='muted' style='font-size:12px'>${a.desc}</div>`;
    const right = document.createElement('div');
    const buy = document.createElement('button');buy.textContent = `Comprar (${a.cost}t)`;buy.onclick = ()=>buyAmulet(i);
    right.appendChild(buy);
    row.appendChild(left);row.appendChild(right);
    storeEl.appendChild(row);
  });

  // equipped
  equippedEl.innerHTML='';
  state.equipped.forEach((a,i)=>{
    const e = document.createElement('div');e.className='amulet equipped';e.style.minWidth='120px';
    e.innerHTML = `<div style='text-align:left'><strong>${a.name}</strong><div class='muted' style='font-size:12px'>${a.desc}</div></div>`;
    const une = document.createElement('button');une.textContent='Quitar';une.onclick=()=>unequip(i);
    e.appendChild(une);
    equippedEl.appendChild(e);
  });
}

// ----- GAME LOGIC -----
function rollOnce(){
  // build weights influenced by equipped amulets
  const baseWeights = state.symbols.map(s=>s.weight);
  const names = state.symbols.map(s=>s.name);
  // apply simple mods
  state.equipped.forEach(a=>{
    if(a.mod){
      if(a.mod.Cherry) baseWeights[names.indexOf('Cherry')] += a.mod.Cherry;
      if(a.mod.Clover) baseWeights[names.indexOf('Clover')] += a.mod.Clover;
    }
  });
  // luck can bias towards higher-value symbols
  const luckBias = Math.floor(state.luck/3);
  if(luckBias>0){
    for(let i=0;i<state.symbols.length;i++) baseWeights[i]+=luckBias;
  }

  // create 3x3 grid
  const grid = [];
  for(let c=0;c<3;c++){
    grid[c]=[];
    for(let r=0;r<3;r++){
      const idx = weightedPick(baseWeights);
      grid[c][r] = state.symbols[idx].id;
    }
  }
  return {grid,selectionWeights:baseWeights};
}

function evaluateGrid(grid){
  // simple scoring: evaluate horizontal center row and vertical middle col and diagonals
  const combos = [];
  // central row index 1 of each reel
  const midRow = [grid[0][1],grid[1][1],grid[2][1]];
  const midCol = [grid[1][0],grid[1][1],grid[1][2]];
  const diag1 = [grid[0][0],grid[1][1],grid[2][2]];
  const diag2 = [grid[0][2],grid[1][1],grid[2][0]];
  const lines=[midRow,midCol,diag1,diag2];
  for(const line of lines){
    if(line[0]===line[1] && line[1]===line[2]) combos.push(line[0]);
  }
  // compute coins
  let coins=0;
  combos.forEach(sym=>{
    const s = state.symbols.find(x=>x.id===sym);
    coins += s.value;
  });
  return {coins,combos};
}

function applyAmuletsOnSpin(result){
  // some amulets trigger on spin
  // Example: lucky charm increases luck when you get any combo
  if(result.combos.length>0){
    state.equipped.forEach(a=>{
      if(a.luck) state.luck = clamp(state.luck + a.luck,0,10);
    });
  }
}

function spin(n=1){
  if(state.spinsLeft<=0){alert('No te quedan tiradas. Completa o reinicia.');return}
  for(let i=0;i<n;i++){
    if(state.spinsLeft<=0) break;
    state.spinsLeft--;
    const res = rollOnce();
    renderReelsGrid(res.grid);
    const ev = evaluateGrid(res.grid);
    // double value amulet
    let gained = ev.coins;
    const hasDouble = state.equipped.some(a=>a.doubleOnCombo);
    if(hasDouble && ev.combos.length>0) gained *= 2;
    state.coins += gained;
    // tickets: small chance or combos
    if(ev.combos.length>0) state.tickets += ev.combos.length;
    // apply on-spin amulets
    applyAmuletsOnSpin(ev);
    // small luck increase on good spin
    if(ev.coins>0) state.luck = clamp(state.luck+1,0,10);
    // if luck full -> bonus jackpot
    if(state.luck>=10){
      const jackpot = 50 + Math.floor(Math.random()*50);
      state.coins += jackpot; state.luck=0; state.tickets+=2; alert('¬°Jackpot de suerte! +' + jackpot + ' coins');
    }
  }
  checkDeadlineProgress();
  renderUI();
  autosave();
}

function checkDeadlineProgress(){
  if(state.coins >= state.goal){
    // success: end of round - get rewards, interest, advance round
    const extra = Math.floor(state.atm * (0.02 + (state.equipped.some(a=>a.interest)?0.04:0)) );
    state.coins += extra;
    // ticket seed
    state.equipped.forEach(a=>{ if(a.ticketSeed && state.tickets>=3) state.tickets+=a.ticketSeed; });
    alert('¬°Has pagado la deuda! Avanzas al siguiente deadline. Ganaste '+extra+' coins por inter√©s.');
    // next round buff
    state.round +=1;
    state.goal = Math.floor(state.goal * 1.7 + 20);
    state.spinsLeft = 8 + (state.equipped.some(a=>a.spins)?state.equipped.reduce((s,a)=>s+(a.spins||0),0):0);
    // ATM interest grows
    state.atm = Math.floor(state.atm * 1.02);
    // small reward tickets for success
    state.tickets += 2;
    renderUI();
    autosave();
  } else if(state.spinsLeft<=0){
    // fail: lose some, keep progress
    const lost = Math.min( Math.floor(state.coins * 0.2), 40);
    state.coins = Math.max(0,state.coins - lost);
    alert('No alcanzaste la meta. Perdiste '+lost+' coins. Reinicia la run si quieres intentarlo de nuevo.');
    renderUI();
    autosave();
  }
}

// ----- STORE LOGIC -----
function genStore(){
  // random pick 4 amulets
  const pool = AMULETS_BASE.slice();
  const res = [];
  while(res.length<5 && pool.length>0){
    const idx = Math.floor(Math.random()*pool.length);
    res.push(pool.splice(idx,1)[0]);
  }
  state.store = res;
}

function buyAmulet(i){
  const a = state.store[i];
  if(!a) return;
  if(state.tickets < a.cost){alert('No tienes tickets suficientes');return}
  if(state.equipped.length>=4){alert('Ya tienes 4 amuletos equipados (l√≠mite).');return}
  state.tickets -= a.cost;
  // materialize amulet instance
  const inst = Object.assign({},a);
  const applied = a.apply();
  if(applied.mod) inst.mod=applied.mod;
  if(applied.spins) inst.spins=applied.spins;
  if(applied.interest) inst.interest=applied.interest, inst.interest=true;
  if(applied.ticketSeed) inst.ticketSeed = applied.ticketSeed;
  if(applied.luck) inst.luck = applied.luck;
  if(applied.doubleOnCombo) inst.doubleOnCombo = true;
  state.equipped.push(inst);
  renderUI();
  autosave();
}

function unequip(i){ state.equipped.splice(i,1); renderUI(); autosave(); }

// ----- ATM & persistence -----
function depositATM(){
  const amount = Math.min(state.coins, 50);
  if(amount<=0){alert('No tienes coins para depositar.');return}
  state.coins -= amount; state.atm += amount; renderUI(); autosave();
}

function rerollStore(){
  if(state.coins < 50){alert('Necesitas 50 coins para re-roll la tienda.');return}
  state.coins -= 50; genStore(); renderUI(); autosave();
}

// ----- save/load -----
function autosave(){ localStorage.setItem('lucky_pit_save', JSON.stringify(state)); }
function saveManual(){ localStorage.setItem('lucky_pit_save_manual', JSON.stringify(state)); alert('Guardado manual OK'); }
function loadManual(){ const s = localStorage.getItem('lucky_pit_save_manual'); if(!s){alert('No hay partida guardada manual. Cargando autosave.'); loadAuto(); return} state = JSON.parse(s); renderUI(); renderReelsGrid([['?','?','?'],['?','?','?'],['?','?','?']]); }
function loadAuto(){ const s = localStorage.getItem('lucky_pit_save'); if(!s){alert('No hay autosave. Iniciando nueva run.'); newRun(); return} state = JSON.parse(s); renderUI(); renderReelsGrid([['?','?','?'],['?','?','?'],['?','?','?']]); }

// ----- new run -----
function newRun(){
  state = {
    coins:120,
    tickets:2,
    atm:0,
    round:1,
    goal:100,
    spinsLeft:10,
    luck:0,
    store:[],
    equipped:[],
    symbols: JSON.parse(JSON.stringify(SYMBOLS))
  };
  genStore(); renderUI(); renderReelsGrid([['?','?','?'],['?','?','?'],['?','?','?']]); autosave();
}

// ----- UI events -----
document.getElementById('spinBtn').onclick = ()=>spin(1);
document.getElementById('multiSpinBtn').onclick = ()=>spin(3);
document.getElementById('bankBtn').onclick = ()=>depositATM();
document.getElementById('rerollStoreBtn').onclick = ()=>rerollStore();
document.getElementById('newRunBtn').onclick = ()=>{ if(confirm('Iniciar nueva run? Se perder√° el progreso actual en memoria si no guardas.')) newRun(); };
document.getElementById('saveBtn').onclick = ()=>saveManual();
document.getElementById('loadBtn').onclick = ()=>loadManual();

// init
genStore(); renderUI(); renderReelsGrid([['?','?','?'],['?','?','?'],['?','?','?']]); autosave();

</script>
</body>
</html>
